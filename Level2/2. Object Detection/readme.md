## Object Detecetion Competition Wrap Up

### 1. 프로젝트 목표
- 이번 프로젝트의 최대 목표는 최대한 다양한 협업 툴을 사용해서 협업 능력을 키우는 것 입니다.
- 깃허브, Wandb, 슬랙, 노션을 연동하고 이를 적극적으로 사용해서 실제 현업과 비슷한 협업 방식을 경험해보는 것을 목표로 잡았습니다.
- 또한 Detection 모듈에(MMDetection, Detectron2, YOLO v5)에 강의에서 학습한 내용과 실험을 위해 필요한 기능을 구현하고 적용함으로써 코딩 능력을 올리는 것 입니다.


### 내가 시도한 점
#### 1 Stage Model (YOLO v5)
- 실험 속도가 가장 빠른 yolov5m(Medium) 모델을 이용해서 하이퍼 파라미터 실험을 진행했습니다. Wandb를 이용해서 각 파라미터가 valid mAP 성능에 얼마나 영향을 주는지 파악할 수 있었습니다.
- Epoch을 크게 잡고 학습을 했을 때, valid mAP가 높아졌지만 리더보드에 제출한 결과가 너무 낮았습니다. Wandb로 분석해보니, train loss가 계속 줄어드는 반면에 valid loss가 일정 epoch 이상부터 계속 증가하는 것을 발견했습니다.
- 이를 해결하기 위해 Epoch에 변화를 주고 Multi Scale을 사용해서 실험을 해봤습니다. 결과적으로 학습 단계에서 Epoch 30과 img size 1024에 multi-scale(±50%)을 적용했을 때 최고 성능을 가졌습니다. 

![image](https://user-images.githubusercontent.com/48708496/162604445-c08b2fe9-b9c5-4ca5-ae63-787ce83a3664.png)

- Multi Scale Training을 통해 다양한 입력 사이즈를 학습하게 되면서, 특정 이미지 사이즈에 Overfitting되는 문제를 해결하면서 작은 물체의 탐지 성능도 높아지게 된 것 같습니다. 실제로 리더보드 성적도 많이 올라가게 됐습니다.
- Inference에서는 TTA를 적용하고, 다른 파라미터를 적용한 YOLO 모델끼리 앙상블을 하는 방법으로 최종 성능을 많이 올릴 수 있었습니다.

#### Ensemble
- YOLO v5의 성능을 높이고자, 모델 다양성과 데이터 다양성을 고려해서 YOLO 모델간 앙상블을 시도했습니다.
- yolov5l, yolov5x, yolov5l6, yolov5x6 4가지 모델을 NMS로 앙상블한 모델과, 가장 성능이 좋았던 yolov5x6에 K Fold 앙상블을 적용한 모델, 총 2가지를 만들었고 2 Stage Model들과 최종 앙상블(WBF)을 함으로써 리더보드 성능을 높일 수 있었습니다.

- WBF, Soft NMS 앙상블 코드를 팀에 공유했고, 최종 앙상블 단계에서 이를 활용해 리더보드 성적을 올릴 수 있었습니다.
- 유사한 모델들을 그룹지어 각각 SoftNMS Ensemble을 통해 중간 결과를 생성하고, 그 결과를 최종적으로 모아 WBF로 앙상블하는 분할 정복 앙상블 전략을 제시했습니다. 최종 리더보드 성능을 높이지는 못했지만 

#### 협업
- 슬랙과 깃허브를 연동해서, 깃허브 Issue가 생길 때마다 슬랙에 알림이 가도록 했습니다. 이를 통해 해당 Issue에 대해 빠르게 의견 공유를 할 수 있었습니다.
- Issue를 통해 팀에 의견이나 결과를 공유할 때는 실험 배경, 내용, 결과 등을 자세히 작성했습니다. 또한 Issue에 템플릿과 레이블을 적용해서 작성 방식을 정하고 해당 Issue가 어떤 주제인지 구별하기 쉽게 만들었습니다.
- 깃허브 프로젝트의 칸반 보드를 사용해서 프로젝트 현황과 진척도를 확인할 수 있었습니다.

![image](https://user-images.githubusercontent.com/48708496/162605485-e1cae75b-d489-4463-9382-59a3f0d728d6.png)

- 깃허브 Issue와 노션에 단일 모델과 앙상블 모델의 실험 관리 테이블을 만들어서 팀원간 모델의 정보를 쉽게 공유할 수 있었습니다.
- Wandb를 사용해서 모델의 성능과 분석 결과를 팀원에게 시각적으로 제공할 수 있었고, Wandb 팀 프로젝트를 사용해서 팀원들의 모델 성능을 쉽게 파악할 수 있었습니다.


### 느낀점
#### 마주한 한계와 아쉬운 점 
- 모델의 다양성을 위해 CenterNet, DETR, EfficientDet 모델에 대해서도 실험을 진행했지만 중간중간 발생한 여러 에러와 낮은 성능 때문에 최종 앙상블에 사용하지 못했습니다. 
- Detection 라이브러리를 완벽히 다루질 못했고, 오류가 생겼을 때 이를 해결하는 실력이 많이 부족했습니다.


- 프로젝트 전반적인 시간 관리를 못해서 더 다양한 실험을 못했다는게 제일 아쉬웠습니다.
- 데이터셋을 5 Stratified Fold로 나누고, Fold 3 데이터가 리더보드와 가장 상관관계가 높다는 것을 발견한 점은 좋았지만, 실험 기간이 길어져서 전체 데이터셋을 활용하는 시점이 늦어졌습니다.
- 또한 Pseudo Lableing의 학습 시간이 길어서 이에 대한 실험을 많이 진행하질 못했습니다. 결국 최종 앙상블 단계에서 이를 활용하지 못했습니다.


- 깃허브의 pull request와 branch를 사용하질 못 했습니다.


#### 이전 P-Stage와 비교해서 달라진 점
- 이전 P-Stage에는 각자 실험을 하고 성능이 좋았던 모델을 공유만 했었다.
- 이번 P-Stage에는 협업 툴을 적극적으로 이용해서 프로젝트와 실험을 관리했고, 이를 팀원에게 효율적으로 공유할 수 있었다.
- 결과적으로 멘토님께서 실무와 정말 비슷하게 협업을 진행하고 있다는 평을 해주셨다.
- Wandb, FiftyOne을 사용해서 모델의 성능과 결과를 시각해해서 분석할 수 있었다. 또한 모델과 파라미터의 성능을 비교할 때도 용이하게 진행할 수 있었다.

#### 다음 P-Stage에서 시도할 것 
- Pull Request, Code Review 통해서 더 효율적으로 깃허브를 사용해서 협업을 하려고 합니다.
- 멘토님이 조언해주신 기능 위주의 Branch를 생성하고 병합하는 방식으로 코드 관리를 할 예정입니다.
- 실험 분석 내용들을 미리 정리하고 시각화 할 생각입니다. 이번 P-Stage에서는 짧은 시간에 너무나 많은 실험을 진행하다보니 이전에 실험한 모델을 추적하거나 앙상블 단계에서 필요한 모델을 찾는데 어려움이 있었습니다.
